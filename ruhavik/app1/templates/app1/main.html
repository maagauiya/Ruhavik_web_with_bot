{% load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<style>
  body{
    background-color: white;
    overflow-x: hidden;
  }
    td{
        text-align: center !important;
    }
    th{
        text-align: center !important;

    }
    .leftalign{
      text-align: left !important;
      padding-bottom: 0px !important;
      padding-top: 0px !important;
    }

    .wrapper{
      display:flex;
  justify-content:space-between;
    }
    p {
      margin: 0 !important;
    }
    
iframe {
  /* width: 76.92% !important; */
  height: 125% !important;
  width: 125%; 
  -webkit-transform: scale(1.0);
  transform: scale(0.8);
  -webkit-transform-origin: 0 0;
  transform-origin: 0 0;
  display:block;
}
</style>
<body>
    <div class="container-fluids" >

        <div class="row">
            <div class="col" >
                <table class="table table-bordered" style="overflow-y: auto; background-color: white;">
                    <thead class="table-light">
                      <tr>
                        <th scope="col" style="width: 60px !important; text-align: center !important;"><img src= "{% static 'app1/images/smth.png' %}" alt="" width="30px" height="30px"></th>
                        <th scope="col">№ А/Т</th>
                        <th scope="col">Водитель</th>

                        <th scope="col" style="width: 60px !important; text-align: center !important;"><img src="{% static 'app1/images/camera.png' %}" width="30px" height="30px" alt=""></th>
                        <th scope="col" style="width: 60px !important; text-align: center !important;"><img src="{% static 'app1/images/tools.png' %}" alt="" width="30px" height="30px"></th>
                        <th scope="col" style="width: 60px !important; text-align: center !important;"><img src="{% static 'app1/images/journal.png' %}" alt="" width="30px" height="30px"></th>
                        <th scope="col">Пробег км</th>
                    
                    </tr>
                    </thead>
                    <tbody>
                      {% for i in drivers %}
                      <tr>
                        <th scope="row" style="padding: 0 !important;"><img  id="start_{{i.id}}" src="{% static 'app1/images/red.png' %}" alt="" width="40px" height="40px"></th>
                        <td>{{i.car.car_number}}</td>
                        <td>{{i.driver_name}} {{i.driver_last_name}}</td>
                        <td style="padding: 0 !important;"><img id="camera_{{i.id}}" src="{% static 'app1/images/red.png' %}" alt="" width="40px" height="40px"></td>
                        <td style="padding: 0 !important;"><img id="car_{{i.id}}" src="{% static 'app1/images/red.png' %}" alt="" width="40px" height="40px"></td>
                        <td id="ssd_{{i.id}}">4</td>
                        <td id="km_{{i.id}}">---</td>
                      </tr>
                      {% endfor %}
                     
                      
                    
                    </tbody>
                  </table>
            </div>
            <div class="col">
              <div class="row" >
                <div style="text-align: center; background-color: white;" class="col-8">
                  <h3 style="align-items: center !important;">График активности</h3>
                  <hr style="margin-top: 0;">
                  <canvas id="myChart2" style="width:100%; height: 195px;"></canvas>
                </div>
                <div  style=" text-align: center; background-color: white;" class="col-4">
                  <h3 style="align-items: center !important;">Уникальные КМ</h3>
                  <hr style="margin-top: 0;">
                  <canvas id="myChart" style="width:100%;"></canvas>
                  
                  <h4>{{percentage}}%</h4>
                  <p>{{unique.km}}км/50 000 км</p>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-3" style="margin: 0 !important; overflow-y: auto; width: 25% ; height: 610px;">
              <table class="table table-bordered" style=" background-color: white; margin-bottom: 0; ">
              <thead class="table-light">
                <tr>
                  <th scope="col" class="leftalign" style="width: 20px;">№</th>
                  <th scope="col" class="leftalign" >Города</th>
                </tr>
              </thead>
              <tbody>
                {% for i in cities%}
                <tr>
                  <th scope="row" class="leftalign">{{forloop.counter}}</th>
                  <td class="leftalign" >
                    <div class="wrapper">
                      <div>
                          <p>{{i.city_name}}</p>
                      </div>
                      {%if i.state == 1%}
                      <div>
                        <img src="{% static 'app1/images/yellow.png' %}" alt="" width="30px" height="30px" style="padding: 0px !important;">
                      </div>
                      {% elif i.state == 2%}
                      <div>
                        <img src="{% static 'app1/images/green.png' %}" alt="" width="30px" height="30px" style="padding: 0px !important;">
                      </div>
                      {% else %}
                      <div>
                        <img src="{% static 'app1/images/red.png' %}" alt="" width="30px" height="30px" style="padding: 0px !important;">
                      </div>
                      {% endif %}
                    </div>
                  </td>
                </tr>
                {% endfor %}
                
           
              </tbody>
            </table></div>
            <div class="col-9"><iframe src="https://ruhavik.gurtam.space/units/all" frameborder="0" ></iframe></div>

            <!-- <div class="col-9"><iframe src="https://ruhavik.gurtam.space/units/all" frameborder="0" style="border-style: none; width: 100%; height: 100%;"></iframe></div> -->
          </div>
          


          <!-- <div class="row">
            <div class="col" style="background-color: aqua; height: 300px !important;">
              1 of 2
            </div>
            <div class="col" style="height: 300px !important;">
                <iframe src="https://ruhavik.gurtam.space/units/all" frameborder="0" style="border-style: none; width: 100%; height: 400px;"></iframe>

            </div>
          </div> -->
    </div>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js">
      </script>
    <script src="main.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
      <script>

        var a = "{{km}}";

       var url = "http://127.0.0.1:8000/test/";

       
      
       function ajax123() {
        $.ajax({
          type: "get",
          url: url,
          complete: res => {
              if (res.status == 200){
                  // const result = JSON.parse(res.responseJSON);
                  for (var i = 0 ;i<res.responseJSON.models_to_return.length;i++){ 
                    if (res.responseJSON.models_to_return[i].cover_check == false){ 
                      $('#camera_'+(res.responseJSON.models_to_return[i].id).toString()).attr('src',"{% static 'app1/images/red.png' %}")
                    }
                    else{ 
                      $('#camera_'+(res.responseJSON.models_to_return[i].id).toString()).attr('src',"{% static 'app1/images/green.png' %}")
                    }
                  }
              }
              else {
                  console.log("das")
              }
          }
        }); 
        //
        $.ajax({
          type: "get",
          url: "http://127.0.0.1:8000/start/",
          complete: res => {
              if (res.status == 200){
                  // const result = JSON.parse(res.responseJSON);
                  
                  for (var i = 0 ;i<res.responseJSON.models_to_return.length;i++){ 
                    if (res.responseJSON.models_to_return[i].documents_check == false){ 
                      $('#start_'+(res.responseJSON.models_to_return[i].id).toString()).attr('src',"{% static 'app1/images/red.png' %}")
                      $('#car_'+(res.responseJSON.models_to_return[i].id).toString()).attr('src',"{% static 'app1/images/red.png' %}")
                    }
                    else{ 
                      $('#start_'+(res.responseJSON.models_to_return[i].id).toString()).attr('src',"{% static 'app1/images/green.png' %}")
                      $('#car_'+(res.responseJSON.models_to_return[i].id).toString()).attr('src',"{% static 'app1/images/green.png' %}")
                    }
                  }
              }
              else {
                  console.log("das")
              }
          }
        });

        //
        $.ajax({
          type: "get",
          url: "http://127.0.0.1:8000/kms/",
          complete: res => {
              if (res.status == 200){
                  // const result = JSON.parse(res.responseJSON);
                  
                  for (var i = 0 ;i<res.responseJSON.models_to_return.length;i++){ 
                    if (res.responseJSON.models_to_return[i].tablet_connection == true){ 
                      $('#km_'+(res.responseJSON.models_to_return[i].id).toString()).text(res.responseJSON.models_to_return[i].odometer_and_dashboard_readings_data)
                    }
                    else{ 
                      $('#km_'+(res.responseJSON.models_to_return[i].id).toString()).text("-")

                    }
                
                  }
              }
              else {
                  console.log("das")
              }
          }
        });

        window.setTimeout(ajax123, 100);

       }
       window.setTimeout(ajax123, 100);
      
        var myChart = new Chart("myChart", {
          
          type: "doughnut",
          data: {
            labels: [
                    'Пройдено',
                    'Осталось',
                ],
            datasets: [{
                    data: [a,50000-a],
                    backgroundColor: [
                      'rgb(2, 237, 0)',
                      'rgb(193, 240, 203)',
                    ],
                }],
              
                // These labels appear in the legend and in the tooltips when hovering different arcs
                
          },
          options: {}
        });
        var speedData = {
          labels: [],
          datasets: [
            {

            }
          ]

        //   datasets: [{
        //     label: "1",
        //     data: [4, 6, 7, 7, 5, 2, 2],
        //     fill: false,
        //     tension: 0.1,
        //     borderColor: 'rgb(75, 192, 192)',
        //   },
        //   {
        //     label: "2",
        //     data: [7, 5, 1, 6, 2, 0, 0],
        //     fill: false,
        //     tension: 0.1,
        //     borderColor: 'rgb(53, 57, 143)',
        //   },
        //   {
        //     label: "3",
        //     data: [4, 6, 7, 8, 2, 4, 0],
        //     fill: false,
        //     tension: 0.1,
        //     borderColor: 'rgb(15, 84, 107)',
        //   },
        //   {
        //     label: "4",
        //     data: [6, 4, 7, 8, 2, 0, 0],
        //     fill: false,
        //     tension: 0.1,
        //     borderColor: 'rgb(122, 215, 210)',
        //   },
        //   {
        //     label: "5",
        //     data: [6, 6, 8, 2, 9, 0, 0],
        //     fill: false,
        //     tension: 0.1,
        //     borderColor: 'rgb(220, 102, 165)',
        //   }
        // ]
        };

        var chartOptions = {
          
        };
        var myChart2 = new Chart("myChart2", {
          
          type: "line",
          data: speedData,
          options: chartOptions
        });

      </script>

  </body>
</html>